if not IsDuplicityVersion() then --client
    izzy.weapons = {
        [-1075685676] = {name = "WEAPON_PISTOL_MK2", label = "Pistol MK2"},
        [126349499] = {name = "WEAPON_SNOWBALL", label = "Snowball"},
        [-270015777] = {name = "WEAPON_ASSAULTSMG", label = "Assault SMG"},
        [615608432] = {name = "WEAPON_MOLOTOV", label = "Molotov"},
        [2024373456] = {name = "WEAPON_SMG_MK2", label = "SMG MK2"},
        [-1810795771] = {name = "WEAPON_POOLCUE", label = "Pool Cue"},
        [-1813897027] = {name = "WEAPON_GRENADE", label = "Grenade"},
        [-598887786] = {name = "WEAPON_MARKSMANPISTOL", label = "Marksman Pistol"},
        [-1654528753] = {name = "WEAPON_BULLPUPSHOTGUN", label = "Bullpup Shotgun"},
        [-72657034] = {name = "GADGET_PARACHUTE", label = "Parachute"},
        [-102323637] = {name = "WEAPON_BOTTLE", label = "Bottle"},
        [2144741730] = {name = "WEAPON_COMBATMG", label = "Combat MG"},
        [-1121678507] = {name = "WEAPON_MINISMG", label = "Mini SMG"},
        [-1652067232] = {name = "WEAPON_SWEEPERSHOTGUN", label = "Sweeper Shotgun"},
        [961495388] = {name = "WEAPON_ASSAULTRIFLE_MK2", label = "Assault Rifle MK2"},
        [-86904375] = {name = "WEAPON_CARBINERIFLE_MK2", label = "Carbine Rifle MK2"},
        [-1786099057] = {name = "WEAPON_BAT", label = "Bat"},
        [177293209] = {name = "WEAPON_HEAVYSNIPER_MK2", label = "Heavy Sniper MK2"},
        [600439132] = {name = "WEAPON_BALL", label = "Ball"},
        [1432025498] = {name = "WEAPON_PUMPSHOTGUN_MK2", label = "Pump Shotgun MK2"},
        [-1951375401] = {name = "WEAPON_FLASHLIGHT", label = "Flashlight"},
        [171789620] = {name = "WEAPON_COMBATPDW", label = "Combat PDW"},
        [1593441988] = {name = "WEAPON_COMBATPISTOL", label = "Combat Pistol"},
        [-2009644972] = {name = "WEAPON_SNSPISTOL_MK2", label = "SNS Pistol MK2"},
        [2138347493] = {name = "WEAPON_FIREWORK", label = "Firework"},
        [1649403952] = {name = "WEAPON_COMPACTRIFLE", label = "Compact Rifle"},
        [-619010992] = {name = "WEAPON_MACHINEPISTOL", label = "Machine Pistol"},
        [-952879014] = {name = "WEAPON_MARKSMANRIFLE", label = "Marksman Rifle"},
        [317205821] = {name = "WEAPON_AUTOSHOTGUN", label = "Auto Shotgun"},
        [-1420407917] = {name = "WEAPON_PROXMINE", label = "Proximity Mine"},
        [-1045183535] = {name = "WEAPON_REVOLVER", label = "Revolver"},
        [94989220] = {name = "WEAPON_COMBATSHOTGUN", label = "Combat Shotgun"},
        [-1658906650] = {name = "WEAPON_MILITARYRIFLE", label = "Military Rifle"},
        [1198256469] = {name = "WEAPON_RAYCARBINE", label = "Ray Carbine"},
        [2132975508] = {name = "WEAPON_BULLPUPRIFLE", label = "Bullpup Rifle"},
        [1627465347] = {name = "WEAPON_GUSENBERG", label = "Gusenberg Sweeper"},
        [984333226] = {name = "WEAPON_HEAVYSHOTGUN", label = "Heavy Shotgun"},
        [1233104067] = {name = "WEAPON_FLARE", label = "Flare"},
        [-1716189206] = {name = "WEAPON_KNIFE", label = "Knife"},
        [940833800] = {name = "WEAPON_STONE_HATCHET", label = "Stone Hatchet"},
        [1305664598] = {name = "WEAPON_GRENADELAUNCHER_SMOKE", label = "Grenade Launcher Smoke"},
        [727643628] = {name = "WEAPON_CERAMICPISTOL", label = "Ceramic Pistol"},
        [-1074790547] = {name = "WEAPON_ASSAULTRIFLE", label = "Assault Rifle"},
        [-1169823560] = {name = "WEAPON_PIPEBOMB", label = "Pipe Bomb"},
        [324215364] = {name = "WEAPON_MICROSMG", label = "Micro SMG"},
        [-1834847097] = {name = "WEAPON_DAGGER", label = "Dagger"},
        [-1466123874] = {name = "WEAPON_MUSKET", label = "Musket"},
        [-1238556825] = {name = "WEAPON_RAYMINIGUN", label = "Ray Minigun"},
        [-1063057011] = {name = "WEAPON_SPECIALCARBINE", label = "Special Carbine"},
        [1470379660] = {name = "WEAPON_GADGETPISTOL", label = "Gadget Pistol"},
        [584646201] = {name = "WEAPON_APPISTOL", label = "AP Pistol"},
        [-494615257] = {name = "WEAPON_ASSAULTSHOTGUN", label = "Assault Shotgun"},
        [-771403250] = {name = "WEAPON_HEAVYPISTOL", label = "Heavy Pistol"},
        [1672152130] = {name = "WEAPON_HOMINGLAUNCHER", label = "Homing Launcher"},
        [338557568] = {name = "WEAPON_PIPEWRENCH", label = "Pipe Wrench"},
        [1785463520] = {name = "WEAPON_MARKSMANRIFLE_MK2", label = "Marksman Rifle MK2"},
        [-1355376991] = {name = "WEAPON_RAYPISTOL", label = "Ray Pistol"},
        [101631238] = {name = "WEAPON_FIREEXTINGUISHER", label = "Fire Extinguisher"},
        [1119849093] = {name = "WEAPON_MINIGUN", label = "Minigun"},
        [883325847] = {name = "WEAPON_PETROLCAN", label = "Petrol Can"},
        [-102973651] = {name = "WEAPON_HATCHET", label = "Hatchet"},
        [-275439685] = {name = "WEAPON_DBSHOTGUN", label = "Double Barrel Shotgun"},
        [-1746263880] = {name = "WEAPON_DOUBLEACTION", label = "Double Action Revolver"},
        [-879347409] = {name = "WEAPON_REVOLVER_MK2", label = "Revolver MK2"},
        [125959754] = {name = "WEAPON_COMPACTLAUNCHER", label = "Compact Launcher"},
        [911657153] = {name = "WEAPON_STUNGUN", label = "Stun Gun"},
        [-2066285827] = {name = "WEAPON_BULLPUPRIFLE_MK2", label = "Bullpup Rifle MK2"},
        [-538741184] = {name = "WEAPON_SWITCHBLADE", label = "Switchblade"},
        [100416529] = {name = "WEAPON_SNIPERRIFLE", label = "Sniper Rifle"},
        [-656458692] = {name = "WEAPON_KNUCKLE", label = "Knuckle Duster"},
        [-1768145561] = {name = "WEAPON_SPECIALCARBINE_MK2", label = "Special Carbine MK2"},
        [1737195953] = {name = "WEAPON_NIGHTSTICK", label = "Nightstick"},
        [2017895192] = {name = "WEAPON_SAWNOFFSHOTGUN", label = "Sawed-Off Shotgun"},
        [-2067956739] = {name = "WEAPON_CROWBAR", label = "Crowbar"},
        [-1312131151] = {name = "WEAPON_RPG", label = "RPG"},
        [-1568386805] = {name = "WEAPON_GRENADELAUNCHER", label = "Grenade Launcher"},
        [205991906] = {name = "WEAPON_HEAVYSNIPER", label = "Heavy Sniper"},
        [1834241177] = {name = "WEAPON_RAILGUN", label = "Railgun"},
        [-1716589765] = {name = "WEAPON_PISTOL50", label = "Pistol .50"},
        [736523883] = {name = "WEAPON_SMG", label = "SMG"},
        [1317494643] = {name = "WEAPON_HAMMER", label = "Hammer"},
        [453432689] = {name = "WEAPON_PISTOL", label = "Pistol"},
        [1141786504] = {name = "WEAPON_GOLFCLUB", label = "Golf Club"},
        [-1076751822] = {name = "WEAPON_SNSPISTOL", label = "SNS Pistol"},
        [-2084633992] = {name = "WEAPON_CARBINERIFLE", label = "Carbine Rifle"},
        [487013001] = {name = "WEAPON_PUMPSHOTGUN", label = "Pump Shotgun"},
        [-1168940174] = {name = "WEAPON_HAZARDCAN", label = "Hazard Can"},
        [-38085395] = {name = "WEAPON_DIGISCANNER", label = "Digiscanner"},
        [-1853920116] = {name = "WEAPON_NAVYREVOLVER", label = "Navy Revolver"},
        [-37975472] = {name = "WEAPON_SMOKEGRENADE", label = "Smoke Grenade"},
        [-1600701090] = {name = "WEAPON_BZGAS", label = "BZ Gas"},
        [-1357824103] = {name = "WEAPON_ADVANCEDRIFLE", label = "Advanced Rifle"},
        [-581044007] = {name = "WEAPON_MACHETE", label = "Machete"},
        [741814745] = {name = "WEAPON_STICKYBOMB", label = "Sticky Bomb"},
        [-608341376] = {name = "WEAPON_COMBATMG_MK2", label = "Combat MG MK2"},
        [137902532] = {name = "WEAPON_VINTAGEPISTOL", label = "Vintage Pistol"},
        [-1660422300] = {name = "WEAPON_MG", label = "MG"},
        [1198879012] = {name = "WEAPON_FLAREGUN", label = "Flare Gun"}
    }

    if cfg.debug then
        RegisterCommand("resetsettings", function()
            SetResourceKvp("settings", "nil")
            SetResourceKvp("playlists", "nil")
            SetResourceKvp("favoriteMusics", "nil")
        end)
    end

    local name = ""
    plyData = {}
    if framework == 'qb' then
        AddEventHandler('QBCore:Client:OnPlayerLoaded', function()
            plyData = QBCore.Functions.GetPlayerData()
            initialize()
        end)
        RegisterNetEvent('QBCore:Client:OnPlayerUnload', function()
            unloadData()
        end)
        RegisterNetEvent('QBCore:Player:SetPlayerData', function(playerData)
            plyData = playerData
        end)
    elseif framework == 'esx' then
        RegisterNetEvent('esx:playerLoaded', function()
            initialize()
            name = izzy.callback('izzy-hudv6:getName')
        end)

        RegisterNetEvent('esx:onPlayerLogout', function()
            unloadData()
        end)
    end

    local stats = {}
    RegisterNetEvent('esx_status:onTick')
    AddEventHandler('esx_status:onTick', function(data)
        for k,v in pairs(data) do
            stats[v.name] = v.percent
        end
    end)

    AddEventHandler("onResourceStart", function(resourceName)
        if (GetCurrentResourceName() ~= resourceName) then return end
        Wait(500)
        if framework == 'qb' then
            plyData = QBCore.Functions.GetPlayerData()
        end
        initialize()
    end)

    local talking = false
    if GetResourceState('saltychat') == 'started' then
        RegisterNetEvent("SaltyChat_TalkStateChanged", function(state)
            talking = state
        end)
    end

    exports("setDisplay", function(state)
        current.initialized = state
        SendReactMessage('setDisplay', state)
    end)
    
    RegisterNetEvent("izzy-hudv6:client:setDisplay", function(state)
        current.initialized = state
        SendReactMessage('setDisplay', state)
    end)

    getStatus = function(statIndex)
        local pPed = PlayerPedId()
        local pId = PlayerId()
        if statIndex == 'health' then
            return GetEntityHealth(pPed) > 0 and (((GetEntityHealth(pPed) - 100) / (GetEntityMaxHealth(pPed) - 100)) * 100 ) or 0
        elseif statIndex == 'armor' then
            return GetPedArmour(pPed)
        elseif statIndex == 'stamina' then
            if not IsEntityInWater(pPed) then
                return 100 - GetPlayerSprintStaminaRemaining(pId)
            elseif IsEntityInWater(pPed) then
                return GetPlayerUnderwaterTimeRemaining(pId) * 10
            end
        elseif statIndex == 'mic' then
            local voiceType = GetResourceState('saltychat') == 'started' and 'saltychat' or 'other'
            return cfg.voiceRanges[voiceType][tostring(getVoiceState().range)] or 66
        elseif statIndex == 'stress' then
            return current.stress
        else
            if framework == 'qb' then
                return plyData.metadata[statIndex]
            elseif framework == 'esx' then
                return stats[statIndex] or 0
            end
        end
    end

    getDirection = function()
        local playerHeadingDegrees = 360.0 - GetEntityHeading(PlayerPedId())
        local dgr = playerHeadingDegrees - 180 / 2
        local dgr = dgr % 360.0
        if (dgr >= 0.0 and dgr < 22.5) or dgr >= 337.5 then
            return "NE"
        elseif dgr >= 22.5 and dgr < 67.5 then
            return "E"
        elseif dgr >= 67.5 and dgr < 112.5 then
            return "SE"
        elseif dgr >= 112.5 and dgr < 157.5 then
            return "S"
        elseif dgr >= 157.5 and dgr < 202.5 then
            return "SW"
        elseif dgr >= 202.5 and dgr < 247.5 then
            return "W"
        elseif dgr >= 247.5 and dgr < 292.5 then
            return "NE"
        elseif dgr >= 292.5 and dgr < 337.5 then
            return "N"
        end
    end

    calculateTime = function()
        local hour = GetClockHours()
        local minute = GetClockMinutes()
        if hour <= 9 then hour = "0" .. hour end
        if minute <= 9 then minute = "0" .. minute end
    
        return hour .. ":" .. minute
    end

    getTopInfo = function(data)
        local pData = framework == 'qb' and plyData or (framework == 'esx' and ESX.GetPlayerData() or {})
        if data.id == "playerCount" then
            data.value = GlobalState.playerCount
        elseif data.id == "time" then
            data.value = calculateTime()
        elseif data.id == "fullname" then
            if framework == "qb" then
                if QBCore and pData then
                    data.value = ("%s %s"):format(pData.charinfo.firstname, pData.charinfo.lastname)
                    data.secondValue = ('(%s)'):format(GetPlayerServerId(PlayerId()))
                end
            elseif framework == "esx" then
                if ESX and pData then
                    data.value = name
                    data.secondValue = ('(%s)'):format(GetPlayerServerId(PlayerId()))
                end
            end
        elseif data.id == "cash" then
            if framework == 'qb' then
                if QBCore and pData and pData.money then
                    data.value = pData.money['cash']
                end
            elseif framework == 'esx' then
                if ESX and pData then
                    if pData.accounts and pData.accounts['cash'] then
                        data.value = pData.accounts['cash']
                    else
                        data.value = ESX.GetAccount("money").money
                    end
                end
            end
        elseif data.id == "bank" then
            if framework == 'qb' then
                if QBCore and pData and pData.money then
                    data.value = pData.money['bank']
                end
            elseif framework == 'esx' then
                if ESX and pData then
                    if pData.accounts and pData.accounts['bank'] then
                        data.value = pData.accounts['bank']
                    else
                        data.value = ESX.GetAccount("bank").money
                    end
                end
            end
        elseif data.id == "job" then
            if framework == "qb" then
                if QBCore and pData and pData.job then
                    data.value = ("%s - %s"):format(pData.job.label, pData.job.grade.name)
                end
            elseif framework == "esx" then
                if ESX and pData and pData.job then
                    data.value = ("%s - %s"):format(pData.job.label, pData.job.grade_label)
                end
            end
        end

        return data
    end

    getVoiceState = function()
        if GetResourceState('pma-voice') == 'started' then
            return { talking = NetworkIsPlayerTalking(PlayerId()), range = LocalPlayer.state['proximity']?.distance or 0 }
        end

        if GetResourceState('saltychat') == 'started' then
            return { talking = talking, range = exports.saltychat:GetVoiceRange() or 3.0 }
        end

        return { talking = NetworkIsPlayerTalking(PlayerId()), range = 1.5 }
    end

    getFuel = function(vehicle)
        if GetResourceState('savana-fuel') == 'started' then
            return exports['savana-fuel']:GetFuel(vehicle)
        end
        if GetResourceState('LegacyFuel') == 'started' then
            return exports.LegacyFuel:GetFuel(vehicle)
        end
        if GetResourceState('cdn-fuel') == 'started' then
            return exports['cdn-fuel']:GetFuel(vehicle)
        end
        if GetResourceState('ox_fuel') == 'started' then
            return Entity(vehicle) and Entity(vehicle).state and Entity(vehicle).state.fuel or 100
        end

        return 100
    end
    
    getSeatbelt = function(vehicle)
        -- You can add your own export for seatbelt state
        return seatbeltOn
    end
    
    getGear = function(vehicle)
        -- You can add your own export for nitrous value
        return GetVehicleCurrentGear(vehicle)
    end

    getPlayerJob = function()
        if current.initialized then
            if framework == "qb" then
                return plyData.job.name
            elseif framework == "esx" then
                return ESX.GetPlayerData().job.name
            else
                return "unknown"
            end
        end
    end

    map = function(mapStyle)
        Wait(50)
        local defaultAspectRatio = 1920 / 1080
        local resolutionX, resolutionY = GetActiveScreenResolution()
        local aspectRatio = resolutionX / resolutionY
        local minimapOffset = 0
        if aspectRatio > defaultAspectRatio then
            minimapOffset = ((defaultAspectRatio - aspectRatio) / 3.6) - 0.008
        end

        if mapStyle == 'square' then
            RequestStreamedTextureDict('squaremap', false)
            if not HasStreamedTextureDictLoaded('squaremap') then
                Wait(150)
            end
            SetMinimapClipType(0)
            AddReplaceTexture('platform:/textures/graphics', 'radarmasksm', 'squaremap', 'radarmasksm')
            AddReplaceTexture('platform:/textures/graphics', 'radarmask1g', 'squaremap', 'radarmasksm')
            SetMinimapComponentPosition('minimap', 'L', 'B', 0.0 + minimapOffset, -0.047, 0.1638, 0.183)
            SetMinimapComponentPosition('minimap_mask', 'L', 'B', 0.0 + minimapOffset, 0.0, 0.128, 0.20)
            SetMinimapComponentPosition('minimap_blur', 'L', 'B', -0.01 + minimapOffset, 0.015, 0.262, 0.300)
            SetBlipAlpha(GetNorthRadarBlip(), 0)
            SetMinimapClipType(0)
        elseif mapStyle == 'circle' then
            RequestStreamedTextureDict('circlemap', false)
            if not HasStreamedTextureDictLoaded('circlemap') then
                Wait(150)
            end
            SetMinimapClipType(1)
            AddReplaceTexture('platform:/textures/graphics', 'radarmasksm', 'circlemap', 'radarmasksm')
            AddReplaceTexture('platform:/textures/graphics', 'radarmask1g', 'circlemap', 'radarmasksm')
            SetMinimapComponentPosition('minimap', 'L', 'B', -0.0100 + minimapOffset, -0.030, 0.180, 0.258)
            SetMinimapComponentPosition('minimap_mask', 'L', 'B', 0.200 + minimapOffset, 0.0, 0.065, 0.20)
            SetMinimapComponentPosition('minimap_blur', 'L', 'B', -0.00 + minimapOffset, 0.015, 0.252, 0.338)
            SetBlipAlpha(GetNorthRadarBlip(), 0)
            SetMinimapClipType(1)
        end
        DisplayRadar(0)
        SetRadarBigmapEnabled(true, false)
        Wait(0)
        SetRadarBigmapEnabled(false, false)
        DisplayRadar(1)
        Wait(100)
        if current.settings.mapVisibility == "onlyInVehicle" and not IsPedInAnyVehicle(PlayerPedId(), false) then
            DisplayRadar(0)
        end
    end
else                             --server
    getIdentifier = function(src)
        if framework == 'esx' then
            local xPlayer = ESX.GetPlayerFromId(src);
            if not xPlayer then return end
            return xPlayer.getIdentifier()
        elseif framework == 'qb' then
            local xPlayer = QBCore.Functions.GetPlayer(src);
            if not xPlayer then return end
            return xPlayer.PlayerData.citizenid
        elseif framework == 'standalone' then
            return izzy.getIdentifiers(src, 'license')
        end
    end

    getPlayerName = function(src)
        if framework == 'esx' then
            local xPlayer = ESX.GetPlayerFromId(src);
            if not xPlayer then return end
            return xPlayer.name
        elseif framework == 'qb' then
            local xPlayer = QBCore.Functions.GetPlayer(src);
            if not xPlayer then return end
            return ("%s %s"):format(xPlayer.PlayerData.charinfo.firstname, xPlayer.PlayerData.charinfo.lastname)
        elseif framework == 'standalone' then
            return GetPlayerName(src)
        end
    end
end
