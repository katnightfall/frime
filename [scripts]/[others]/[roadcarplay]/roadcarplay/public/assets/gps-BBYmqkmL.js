import{_ as N,r as u,z as B,L as n,a as P,A as z,b as W,q as $,B as j,l as G,C as O,F as U,y as b,j as V}from"./index-T7h_UdHs.js";const E=2e3,R={__name:"gps",setup(q){const v=u(0),l=B({x:0,y:0,z:0}),f=u(0),g=u(null),p=u(null),a=u(null),s=u(!0),h=u(!1),i={x:4840,y:-5174,width:2e3,height:2e3},x=u({}),y=n.layerGroup(),d=n.layerGroup(),_=n.extend({},n.CRS.Simple,{projection:n.Projection.LonLat,scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/.6931471805599453},distance:function(e,t){var o=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(o*o+r*r)},transformation:new n.Transformation(.02072,117.3,-.0205,172.8),infinite:!0}),C=()=>{const e="https://gtamap.xyz/mapStyles/";x.value={Satellite:n.tileLayer(e+"styleSatelite/{z}/{x}/{y}.jpg",{minZoom:0,maxZoom:5,noWrap:!0,continuousWorld:!1,attribution:"GTA V Map",id:"satellite"}),Atlas:n.tileLayer(e+"styleAtlas/{z}/{x}/{y}.jpg",{minZoom:0,maxZoom:5,noWrap:!0,continuousWorld:!1,id:"atlas"}),Grid:n.tileLayer(e+"styleGrid/{z}/{x}/{y}.png",{minZoom:0,maxZoom:5,noWrap:!0,continuousWorld:!1,id:"grid"})}},w=e=>{e.target.classList.contains("gps-setwaypoint-btn")?T():e.target.classList.contains("gps-clear-btn")&&F()},A=()=>{s.value=!s.value,s.value&&g.value&&a.value.setView([l.y,l.x],a.value.getZoom())},F=()=>{p.value&&(d.removeLayer(p.value),p.value=null,b.post("clearWaypoint"))},M=(e,t)=>{const o=i;return e>=o.x-o.width/2&&e<=o.x+o.width/2&&t>=o.y-o.height/2&&t<=o.y+o.height/2},L=(e,t=0)=>{const r={waypoint:[24,36],navigator:[24,24],vehicle:[32,32],player:[20,20]}[e]||[20,20],c={iconUrl:`/public/img/Map/${e}.png`,iconSize:r,iconAnchor:[r[0]/2,r[1]/2],popupAnchor:[0,-r[1]/2]};return t&&e==="navigator"&&(c.className="rotating-icon",c.rotationAngle=t),n.icon(c)},k=async()=>{try{const t=(await b.post("getLocation")).data;if(!t)return;Object.assign(l,t),f.value=t.heading||0,M(t.x,t.y)&&!h.value&&S(),I(),s.value&&a.value&&a.value.setView([l.y,l.x],a.value.getZoom(),{animate:!0,duration:.5})}catch(e){console.error("Failed to get location:",e)}},I=()=>{g.value&&y.removeLayer(g.value);const e=L("navigator",f.value);g.value=n.marker([l.y,l.x],{icon:e,rotationAngle:f.value,zIndexOffset:1e3}).addTo(z(y)).bindPopup(`<div style="color: white; text-align: center;">
    <b>Current Location</b><br>
    X: ${l.x.toFixed(1)}<br>
    Y: ${l.y.toFixed(1)}<br>
    <button class="gps-clear-btn" style="margin-top: 5px; padding: 2px 8px;">Clear Route</button>
  </div>`)},S=()=>{if(h.value=!0,a.value){const e=n.latLngBounds([i.y-i.height/2,i.x-i.width/2],[i.y+i.height/2,i.x+i.width/2]);n.rectangle(e,{color:"#4a90e2",weight:2,opacity:.3,fillOpacity:.1,className:"cayo-perico-zone"}).addTo(a.value)}},T=()=>{const e=document.getElementById("main_navigate_mark");if(!e)return;const t=parseFloat(e.getAttribute("lat")),o=parseFloat(e.getAttribute("lng"));if(!isNaN(t)&&!isNaN(o)&&(b.post("navigate",{lat:t,lng:o}),a.value)){const r=n.polyline([[l.y,l.x],[t,o]],{color:"#4a90e2",weight:4,opacity:.7,dashArray:"10, 10"}).addTo(a.value);setTimeout(()=>{r&&a.value.removeLayer(r)},1e4)}};return P(()=>{if(C(),v.value=setInterval(k,E),document.addEventListener("click",w),!a.value){a.value=n.map("map",{crs:_,minZoom:1,maxZoom:5,maxNativeZoom:5,preferCanvas:!0,layers:[x.value.Atlas,y,d],center:[0,0],zoom:3,zoomControl:!0,attributionControl:!1});const e=n.DomUtil.create("div","custom-controls");e.style.position="absolute",e.style.top="10px",e.style.right="10px",e.style.zIndex="1000",n.control.layers(x.value,{Player:y,Waypoints:d},{position:"topright",collapsed:!1}).addTo(a.value);const t=n.control({position:"bottomright"});t.onAdd=()=>{const o=n.DomUtil.create("div","leaflet-bar leaflet-control");return o.innerHTML=`<a href="#" title="Toggle Follow Mode" 
        style="background: ${s.value?"#4a90e2":"#666"}; 
        color: white; width: 30px; height: 30px; 
        display: flex; align-items: center; justify-content: center;">âŠ™</a>`,o.onclick=r=>{r.preventDefault(),A(),o.querySelector("a").style.background=s.value?"#4a90e2":"#666"},o},t.addTo(a.value),k(),a.value.on("click",o=>{p.value&&d.removeLayer(p.value);const r=o.latlng,c=r.lat,m=r.lng,Z=`
        <div style="color: white; text-align: center; min-width: 120px;">
          <b>Waypoint</b><br>
          X: ${m.toFixed(1)} | Y: ${c.toFixed(1)}<br>
          <button id="main_navigate_mark" class="gps-setwaypoint-btn" 
            lng="${m}" lat="${c}" 
            style="margin: 5px 2px; padding: 4px 10px; background: #4a90e2; 
            border: none; border-radius: 3px; color: white; cursor: pointer;">
            Navigate
          </button>
          <button class="gps-clear-btn" 
            style="margin: 5px 2px; padding: 4px 10px; background: #dc3545; 
            border: none; border-radius: 3px; color: white; cursor: pointer;">
            Clear
          </button>
        </div>
      `;p.value=n.marker([c,m],{icon:L("waypoint"),zIndexOffset:500}).addTo(z(d)).bindPopup(Z).openPopup(),s.value||a.value.setView([c,m],a.value.getZoom())}),a.value.on("dragstart",()=>{s.value=!1})}}),W(()=>{v.value&&(clearInterval(v.value),v.value=null),document.removeEventListener("click",w),a.value&&(a.value.off(),a.value.remove(),a.value=null)}),(e,t)=>(V(),$(U,null,[t[0]||(t[0]=j("div",{id:"map",style:{position:"absolute",width:"100%",height:"88%","border-bottom-left-radius":"1.5vh","border-top-left-radius":"1.5vh","border-bottom-right-radius":"1.5vh"}},null,-1)),G(O)],64))}},H=N(R,[["__scopeId","data-v-8d9d9b25"]]);export{H as default};
