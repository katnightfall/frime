import{R as ve,_ as ie,G as de,H,I as he,S as ue,y as B,K as $e,e as X,T as me,U as ee,q as v,B as m,P as ge,m as j,x as E,Q as fe,F as Z,s as se,j as S,g as F,V as ye,l as te,J as ne,E as N,f as we}from"./index-T7h_UdHs.js";var J={exports:{}},be=J.exports,le;function De(){return le||(le=1,(function(e,l){(function($,h){e.exports=h()})(be,(function(){var $=1e3,h=6e4,g=36e5,d="millisecond",a="second",i="minute",p="hour",I="day",W="week",k="month",re="quarter",O="year",x="date",ae="Invalid Date",pe=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,Me=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_e={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(o){var n=["th","st","nd","rd"],s=o%100;return"["+o+(n[(s-20)%10]||n[s]||n[0])+"]"}},K=function(o,n,s){var r=String(o);return!r||r.length>=n?o:""+Array(n+1-r.length).join(s)+o},Se={s:K,z:function(o){var n=-o.utcOffset(),s=Math.abs(n),r=Math.floor(s/60),t=s%60;return(n<=0?"+":"-")+K(r,2,"0")+":"+K(t,2,"0")},m:function o(n,s){if(n.date()<s.date())return-o(s,n);var r=12*(s.year()-n.year())+(s.month()-n.month()),t=n.clone().add(r,k),c=s-t<0,u=n.clone().add(r+(c?-1:1),k);return+(-(r+(s-t)/(c?t-u:u-t))||0)},a:function(o){return o<0?Math.ceil(o)||0:Math.floor(o)},p:function(o){return{M:k,y:O,w:W,d:I,D:x,h:p,m:i,s:a,ms:d,Q:re}[o]||String(o||"").toLowerCase().replace(/s$/,"")},u:function(o){return o===void 0}},Y="en",T={};T[Y]=_e;var oe="$isDayjsObject",Q=function(o){return o instanceof z||!(!o||!o[oe])},R=function o(n,s,r){var t;if(!n)return Y;if(typeof n=="string"){var c=n.toLowerCase();T[c]&&(t=c),s&&(T[c]=s,t=c);var u=n.split("-");if(!t&&u.length>1)return o(u[0])}else{var M=n.name;T[M]=n,t=M}return!r&&t&&(Y=t),t||!r&&Y},y=function(o,n){if(Q(o))return o.clone();var s=typeof n=="object"?n:{};return s.date=o,s.args=arguments,new z(s)},f=Se;f.l=R,f.i=Q,f.w=function(o,n){return y(o,{locale:n.$L,utc:n.$u,x:n.$x,$offset:n.$offset})};var z=(function(){function o(s){this.$L=R(s.locale,null,!0),this.parse(s),this.$x=this.$x||s.x||{},this[oe]=!0}var n=o.prototype;return n.parse=function(s){this.$d=(function(r){var t=r.date,c=r.utc;if(t===null)return new Date(NaN);if(f.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var u=t.match(pe);if(u){var M=u[2]-1||0,_=(u[7]||"0").substring(0,3);return c?new Date(Date.UTC(u[1],M,u[3]||1,u[4]||0,u[5]||0,u[6]||0,_)):new Date(u[1],M,u[3]||1,u[4]||0,u[5]||0,u[6]||0,_)}}return new Date(t)})(s),this.init()},n.init=function(){var s=this.$d;this.$y=s.getFullYear(),this.$M=s.getMonth(),this.$D=s.getDate(),this.$W=s.getDay(),this.$H=s.getHours(),this.$m=s.getMinutes(),this.$s=s.getSeconds(),this.$ms=s.getMilliseconds()},n.$utils=function(){return f},n.isValid=function(){return this.$d.toString()!==ae},n.isSame=function(s,r){var t=y(s);return this.startOf(r)<=t&&t<=this.endOf(r)},n.isAfter=function(s,r){return y(s)<this.startOf(r)},n.isBefore=function(s,r){return this.endOf(r)<y(s)},n.$g=function(s,r,t){return f.u(s)?this[r]:this.set(t,s)},n.unix=function(){return Math.floor(this.valueOf()/1e3)},n.valueOf=function(){return this.$d.getTime()},n.startOf=function(s,r){var t=this,c=!!f.u(r)||r,u=f.p(s),M=function(L,D){var A=f.w(t.$u?Date.UTC(t.$y,D,L):new Date(t.$y,D,L),t);return c?A:A.endOf(I)},_=function(L,D){return f.w(t.toDate()[L].apply(t.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(D)),t)},w=this.$W,b=this.$M,C=this.$D,G="set"+(this.$u?"UTC":"");switch(u){case O:return c?M(1,0):M(31,11);case k:return c?M(1,b):M(0,b+1);case W:var P=this.$locale().weekStart||0,U=(w<P?w+7:w)-P;return M(c?C-U:C+(6-U),b);case I:case x:return _(G+"Hours",0);case p:return _(G+"Minutes",1);case i:return _(G+"Seconds",2);case a:return _(G+"Milliseconds",3);default:return this.clone()}},n.endOf=function(s){return this.startOf(s,!1)},n.$set=function(s,r){var t,c=f.p(s),u="set"+(this.$u?"UTC":""),M=(t={},t[I]=u+"Date",t[x]=u+"Date",t[k]=u+"Month",t[O]=u+"FullYear",t[p]=u+"Hours",t[i]=u+"Minutes",t[a]=u+"Seconds",t[d]=u+"Milliseconds",t)[c],_=c===I?this.$D+(r-this.$W):r;if(c===k||c===O){var w=this.clone().set(x,1);w.$d[M](_),w.init(),this.$d=w.set(x,Math.min(this.$D,w.daysInMonth())).$d}else M&&this.$d[M](_);return this.init(),this},n.set=function(s,r){return this.clone().$set(s,r)},n.get=function(s){return this[f.p(s)]()},n.add=function(s,r){var t,c=this;s=Number(s);var u=f.p(r),M=function(b){var C=y(c);return f.w(C.date(C.date()+Math.round(b*s)),c)};if(u===k)return this.set(k,this.$M+s);if(u===O)return this.set(O,this.$y+s);if(u===I)return M(1);if(u===W)return M(7);var _=(t={},t[i]=h,t[p]=g,t[a]=$,t)[u]||1,w=this.$d.getTime()+s*_;return f.w(w,this)},n.subtract=function(s,r){return this.add(-1*s,r)},n.format=function(s){var r=this,t=this.$locale();if(!this.isValid())return t.invalidDate||ae;var c=s||"YYYY-MM-DDTHH:mm:ssZ",u=f.z(this),M=this.$H,_=this.$m,w=this.$M,b=t.weekdays,C=t.months,G=t.meridiem,P=function(D,A,V,q){return D&&(D[A]||D(r,c))||V[A].slice(0,q)},U=function(D){return f.s(M%12||12,D,"0")},L=G||function(D,A,V){var q=D<12?"AM":"PM";return V?q.toLowerCase():q};return c.replace(Me,(function(D,A){return A||(function(V){switch(V){case"YY":return String(r.$y).slice(-2);case"YYYY":return f.s(r.$y,4,"0");case"M":return w+1;case"MM":return f.s(w+1,2,"0");case"MMM":return P(t.monthsShort,w,C,3);case"MMMM":return P(C,w);case"D":return r.$D;case"DD":return f.s(r.$D,2,"0");case"d":return String(r.$W);case"dd":return P(t.weekdaysMin,r.$W,b,2);case"ddd":return P(t.weekdaysShort,r.$W,b,3);case"dddd":return b[r.$W];case"H":return String(M);case"HH":return f.s(M,2,"0");case"h":return U(1);case"hh":return U(2);case"a":return L(M,_,!0);case"A":return L(M,_,!1);case"m":return String(_);case"mm":return f.s(_,2,"0");case"s":return String(r.$s);case"ss":return f.s(r.$s,2,"0");case"SSS":return f.s(r.$ms,3,"0");case"Z":return u}return null})(D)||u.replace(":","")}))},n.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},n.diff=function(s,r,t){var c,u=this,M=f.p(r),_=y(s),w=(_.utcOffset()-this.utcOffset())*h,b=this-_,C=function(){return f.m(u,_)};switch(M){case O:c=C()/12;break;case k:c=C();break;case re:c=C()/3;break;case W:c=(b-w)/6048e5;break;case I:c=(b-w)/864e5;break;case p:c=b/g;break;case i:c=b/h;break;case a:c=b/$;break;default:c=b}return t?c:f.a(c)},n.daysInMonth=function(){return this.endOf(k).$D},n.$locale=function(){return T[this.$L]},n.locale=function(s,r){if(!s)return this.$L;var t=this.clone(),c=R(s,r,!0);return c&&(t.$L=c),t},n.clone=function(){return f.w(this.$d,this)},n.toDate=function(){return new Date(this.valueOf())},n.toJSON=function(){return this.isValid()?this.toISOString():null},n.toISOString=function(){return this.$d.toISOString()},n.toString=function(){return this.$d.toUTCString()},o})(),ce=z.prototype;return y.prototype=ce,[["$ms",d],["$s",a],["$m",i],["$H",p],["$W",I],["$M",k],["$y",O],["$D",x]].forEach((function(o){ce[o[1]]=function(n){return this.$g(n,o[0],o[1])}})),y.extend=function(o,n){return o.$i||(o(n,z,y),o.$i=!0),y},y.locale=R,y.isDayjs=Q,y.unix=function(o){return y(1e3*o)},y.en=T[Y],y.Ls=T,y.p={},y}))})(J)),J.exports}var Ce=De();const ke=ve(Ce),Ee={name:"MessagesListLeft",components:{Icon:he},data(){return{messagesList:[],searchMessage:"",searchMessageList:[]}},computed:{...H(ee,["messages"]),...H(me,["contacts"]),...H(X,["IntlString"]),searchMessageContact(){return this.messagesList.filter(e=>e.contact==null?e.sender.toLowerCase().includes(this.searchMessage.toLowerCase()):e.contact.firstname.toLowerCase().includes(this.searchMessage.toLowerCase()))},messageAndGroupData:function(){let e=this.messagesData;return e.sort((l,$)=>$.lastMessageTime-l.lastMessageTime),e},messagesData:function(){let e=[],l=[];this.messages.forEach(h=>{let g=h.sender;(!l[g]||h.id>l[g].id)&&(l[g]=h)});for(let h in l)e.push(l[h]);let $=this.messages.filter((h,g,d)=>g==d.findIndex(a=>a.sender==h.sender));return $.forEach((h,g)=>{let d=this.contacts.find(p=>p.number==h.sender),a="",i="";for(let p=0;p<e.length;p++)if(e[p].sender==h.sender){a=e[p].message,i=e[p].date;break}h.contact=d,this.isSMSImage(a)?h.lastMessage=this.IntlString("APP_MESSAGES_MESSAGE_SENT_IS_PICTURE"):this.isSMSVideo(a)?h.lastMessage=this.IntlString("APP_MESSAGES_MESSAGE_SENT_IS_VIDEO"):this.isSMSGPS(a)?h.lastMessage=this.IntlString("APP_MESSAGES_MESSAGE_SENT_IS_GPS"):this.isSMSAudio(a)?h.lastMessage=this.IntlString("APP_MESSAGES_MESSAGE_SENT_IS_AUDIO"):a.length>27?h.lastMessage=a.substring(0,27)+"...":h.lastMessage=a,h.lastMessageTime=i}),$.sort((h,g)=>g.lastMessageTime-h.lastMessageTime),this.messagesList=$,$}},methods:{...de(X,["setHeaderBlack"]),isSMSImage(e){return/^https?:\/\/.*\.(png|jpg|jpeg|gif)/.test(e)},openChat(e){$e.push("/messages/open/"+e),ue().emit("message_app_update_number",e)},isSMSGPS(e){return e.startsWith("GPS:")},isSMSAudio(e){return/^https?:\/\/.*\.(mp3)/.test(e)},isSMSVideo(e){return/^https?:\/\/.*\.(webm)/.test(e)},isMessagesUnread(e){return this.messages.filter(l=>l.sender==e&&l.isRead!==1).length>0},focus(e){B.inputFocus(e)},formatTime(e){return ke(e).format("DD.MM.YYYY")},toggleNewChat(){ue().emit("messageNewChat")}},mounted(){this.setHeaderBlack(!0)}},Ie={class:"message-app-leftbar"},Oe={class:"message-app-header"},Ae={class:"messages-app-header-title"},Te=["placeholder"],Pe={key:0,class:"messages-container-direct-messages"},Le=["onClick"],xe={key:0,class:"messages-container-direct-messages-unread"},Ge={class:"messages-container-direct-messages-selection-icon"},Ne=["src"],je={class:"messages-container-direct-messages-selection-username"},He={class:"messages-container-direct-messages-selection-message"},Ye={class:"messages-container-direct-messages-selection-date"},Ue={key:1,class:"messages-container-direct-messages"},Ve=["onClick"],Fe={key:0,class:"messages-container-direct-messages-unread"},Be={class:"messages-container-direct-messages-selection-icon"},We=["src"],Re={class:"messages-container-direct-messages-selection-username"},ze={class:"messages-container-direct-messages-selection-message"},qe={class:"messages-container-direct-messages-selection-date"};function Je(e,l,$,h,g,d){return S(),v("div",Ie,[m("div",Oe,[m("div",Ae,E(e.IntlString("APP_MESSAGES_NAME")),1),ge(m("input",{class:"message-app-searchbar-input",onFocus:l[0]||(l[0]=a=>d.focus(!0)),onFocusout:l[1]||(l[1]=a=>d.focus(!1)),"onUpdate:modelValue":l[2]||(l[2]=a=>g.searchMessage=a),placeholder:e.IntlString("APP_MESSAGES_SEARCH_BAR")},null,40,Te),[[fe,g.searchMessage]]),g.searchMessage.length===0?(S(),v("div",Pe,[(S(!0),v(Z,null,se(d.messageAndGroupData,a=>(S(),v("div",null,[m("div",{class:"messages-container-direct-messages-selection",onClick:i=>d.openChat(a.sender)},[d.isMessagesUnread(a.sender)?(S(),v("div",xe)):j("",!0),m("div",Ge,[m("img",{style:{"object-fit":"cover"},src:a.contact?a.contact.picture:"/public/img/user.png"},null,8,Ne)]),m("div",je,E(a.contact?a.contact.firstname+" "+a.contact.lastname:a.sender),1),m("div",He,E(a.lastMessage),1),m("div",Ye,E(d.formatTime(a.lastMessageTime)),1)],8,Le)]))),256))])):j("",!0),g.searchMessage.length>0?(S(),v("div",Ue,[(S(!0),v(Z,null,se(d.searchMessageContact,a=>(S(),v("div",{class:"messages-container-direct-messages-selection",onClick:i=>d.openChat(a.sender)},[d.isMessagesUnread(a.sender)?(S(),v("div",Fe)):j("",!0),m("div",Be,[m("img",{src:a.contact?a.contact.picture:"/public/img/user.png"},null,8,We)]),m("div",Re,E(a.contact?a.contact.firstname+" "+a.contact.lastname:a.sender),1),m("div",ze,E(a.lastMessage),1),m("div",qe,E(d.formatTime(a.lastMessageTime)),1)],8,Ve))),256))])):j("",!0)])])}const Ze=ie(Ee,[["render",Je],["__scopeId","data-v-a6086c3d"]]),Ke="/public/assets/gps-CTFgVPWU.png",Qe={name:"MessagesChat",components:{Icon:he},data(){return{input:"",emojiMenu:!1,phoneNumber:this.$route.params.number.toString(),bottomimage:"/public/img/user.png",isVoiceMailRecording:!1,gps:null,brightness:!1,deleteMessageId:null,selectMenu:!1,money:null}},computed:{...H(ee,["messages","voiceMailWebhook"]),...H(X,["config","IntlString"]),...H(me,["contacts"]),displayContact(){let e=this.contacts.filter(l=>l.number==this.phoneNumber);return e.length>0?(this.bottomimage=e[0].picture,`${e[0].firstname} ${e[0].lastname}`):this.phoneNumber},messagesList(){return this.messages.filter(e=>e.sender==this.phoneNumber).sort((e,l)=>e.id-l.id)}},methods:{...de(ee,["setMessagesRead"]),isSMSImage(e){return/^https?:\/\/.*\.(png|jpg|jpeg|gif)/.test(e.message)},isSMSVideo(e){return/^https?:\/\/.*\.(webm)/.test(e.message)},isSMSGPS(e){return e.message.startsWith("GPS:")},isSMSAudio(e){return/^https?:\/\/.*\.(mp3)/.test(e.message)},focus(e){B.inputFocus(e)},sendMessage(){const e=this.input.trim();e!==""&&(B.sendMessage(this.phoneNumber,e),this.input="")},sendGPS(){B.sendMessage(this.phoneNumber,"%pos%"),this.selectMenu=!1},setGPS(){const e=this.gps,l=/-?\d+\.\d+/g,$=e.match(l);$[0]==null||$[1]==null||(B.post("setGPS",{x:$[0],y:$[1]}),this.gps=null)},scrollDown(){setTimeout(function(){const e=document.getElementById("messages-container-chat-id");e.scrollTop=e.scrollHeight-e.clientHeight},10)}},mounted(){this.emitter.on("message_scrolldown",()=>{this.scrollDown()}),this.emitter.on("message_app_update_number",e=>{this.phoneNumber=e.toString(),this.scrollDown(),this.setMessagesRead(this.phoneNumber)}),this.setMessagesRead(this.phoneNumber),this.scrollDown()},beforeUnmount(){this.emitter.off("message_scrolldown"),this.emitter.off("message_app_update_number")}},Xe={class:"messages-container-name"},es={class:"messages-container-profilepicture"},ss=["src"],ts={id:"messages-container-chat-id",class:"messages-container-chat"},ns=["onContextmenu"],is=["onClick","src"],rs=["onContextmenu"],as=["onClick"],os=["onContextmenu"],cs=["src"],us=["onContextmenu"],ls=["onClick","src"],ds=["onContextmenu"],hs={style:{"background-color":"white",height:"5vh",position:"absolute",bottom:"0",width:"100%"}},ms=["placeholder"];function gs(e,l,$,h,g,d){const a=ne("Icon");return S(),v(Z,null,[m("div",{class:N(["messages-chat-rightbox",{brightness:g.gps||g.brightness||g.deleteMessageId||g.selectMenu}]),style:{"background-color":"#f6f6f8"}},[m("div",Xe,E(d.displayContact),1),m("div",es,[m("img",{src:g.bottomimage},null,8,ss)]),m("div",{style:F([{display:g.emojiMenu?"block":"none"},{position:"absolute","z-index":"150",top:"10vh",left:"0.6vh"}]),id:"message-emoji-menu"},null,4),m("div",ts,[(S(!0),v(Z,null,se(d.messagesList,i=>(S(),v("div",null,[d.isSMSImage(i)?(S(),v("div",{key:0,class:"message-container-chat-img-field",onContextmenu:p=>e.deleteMessageMenu(p,i),style:F({float:i.isOwner===0?"left":"right"})},[m("img",{onClick:p=>e.setBigImage(i.message),src:i.message,class:N({"left-img":i.isOwner===0,"right-img":i.isOwner===1}),alt:"SMS Image"},null,10,is)],44,ns)):d.isSMSGPS(i)?(S(),v("div",{key:1,class:"message-container-chat-gps-field",onContextmenu:p=>e.deleteMessageMenu(p,i),style:F({float:i.isOwner===0?"left":"right"})},[m("img",{onClick:p=>g.gps=i.message,src:Ke,class:N({"left-img":i.isOwner===0,"right-img":i.isOwner===1}),alt:"GPS"},null,10,as)],44,rs)):d.isSMSAudio(i)?(S(),v("div",{key:2,class:"message-container-chat-audio-field",onContextmenu:p=>e.deleteMessageMenu(p,i),style:F({float:i.isOwner===0?"left":"right"})},[m("audio",{controls:"",controlList:"nodownload",style:{outline:"none"},class:N({"left-audio":i.isOwner===0,"right-audio":i.isOwner===1})},[m("source",{src:i.message,type:"audio/mp3"},null,8,cs)],2)],44,os)):d.isSMSVideo(i)?(S(),v("div",{key:3,class:"message-container-chat-img-field",onContextmenu:p=>e.deleteMessageMenu(p,i),style:F({float:i.isOwner===0?"left":"right"})},[m("video",{muted:"muted",onClick:p=>e.setBigImage(i.message),autoplay:"",loop:"",src:i.message,class:N({"left-img":i.isOwner===0,"right-img":i.isOwner===1})},null,10,ls)],44,us)):(S(),v("div",{key:4,class:N(["messages-container-chat-field",{left:i.isOwner===0,right:i.isOwner===1}]),onContextmenu:p=>e.deleteMessageMenu(p,i)},E(i.message),43,ds))]))),256))]),m("div",hs,[ge(m("input",{class:"messages-container-chat-input",onFocus:l[0]||(l[0]=i=>d.focus(!0)),onFocusout:l[1]||(l[1]=i=>d.focus(!1)),onKeyup:l[2]||(l[2]=ye((...i)=>d.sendMessage&&d.sendMessage(...i),["enter"])),"onUpdate:modelValue":l[3]||(l[3]=i=>g.input=i),placeholder:e.IntlString("APP_MESSAGES_CHAT_INPUT_PLACEHOLDER")},null,40,ms),[[fe,g.input]]),m("div",{class:"messages-container-plus",onClick:l[4]||(l[4]=(...i)=>d.sendGPS&&d.sendGPS(...i))},[te(a,{icon:"jam:gps-f"})]),g.input!=""?(S(),v("div",{key:0,class:"messages-container-chat-input-send",onClick:l[5]||(l[5]=(...i)=>d.sendMessage&&d.sendMessage(...i))},[te(a,{icon:"ion:arrow-up"})])):j("",!0)])],2),l[6]||(l[6]=m("div",{id:"messages-voicemail-list",style:{display:"none"}},null,-1))],64)}const fs=ie(Qe,[["render",gs],["__scopeId","data-v-5da9886c"]]),ps={name:"Messages",components:{MessagesChat:fs,MessagesListLeft:Ze}},Ms={class:"home"};function _s(e,l,$,h,g,d){const a=ne("MessagesListLeft"),i=ne("MessagesChat");return S(),v("div",Ms,[te(a),e.$route.name==="messages_open"?(S(),we(i,{key:0})):j("",!0)])}const vs=ie(ps,[["render",_s],["__scopeId","data-v-c44c0dfc"]]);export{vs as default};
